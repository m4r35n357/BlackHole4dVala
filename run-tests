#!/bin/sh
#set -x
C='\033[0;36m'
NC='\033[0m' # No Color

exe='./Simulate'
int='./finterp.py'

run_particle () {
	params=$*
	echo ${C}"$exe"${NC}
	echo $params | jq .
	echo $params | ./GenParticle >$ic 2>$pot
	jq . $ic
	$exe <$ic | ./plotBH.py `jq .IC.M $ic` `jq .IC.a $ic` `jq .IC.L $ic` `jq .IC.mu $ic`
}

run_light () {
	params=$*
	echo ${C}"$exe"${NC}
	echo $params | jq .
	echo $params | ./GenLight >$ic 2>$pot
	jq . $ic
	$exe <$ic | ./plotBH.py `jq .IC.M $ic` `jq .IC.a $ic` `jq .IC.L $ic` `jq .IC.mu $ic`
}

run_particle '{ "method": "dnewton", "rMin": 3.0, "rMax": 12.0, "elevation": 63.0, "spin": 1.0, "Lfac": 1.0, "integrator": "rk4", "step": 0.01, "plotratio": 100 }'
run_particle '{ "method": "dnewton", "rMin": 3.0, "rMax": 12.0, "elevation": 63.0, "spin": 1.0, "Lfac": 1.0, "integrator": "rk438", "step": 0.01, "plotratio": 100 }'
run_particle '{ "method": "dnewton", "rMin": 3.0, "rMax": 12.0, "elevation": 63.0, "spin": 1.0, "Lfac": 1.0, "integrator": "sc4", "plotratio": 50 }'
run_particle '{ "method": "dnewton", "rMin": 3.0, "rMax": 12.0, "elevation": 63.0, "spin": 1.0, "Lfac": 1.0, "integrator": "sc6", "plotratio": 50 }'

run_particle '{ "method": "dnewton", "r": 12.0, "elevation": 90.0, "spin": 1.0, "Lfac": 1.0, "integrator": "rk4", "step": 0.01 }'
run_particle '{ "method": "dnewton", "r": 12.0, "elevation": 90.0, "spin": 1.0, "Lfac": 1.0, "integrator": "rk438", "step": 0.01 }'
run_particle '{ "method": "dnewton", "r": 12.0, "elevation": 90.0, "spin": 1.0, "Lfac": 1.0, "integrator": "sc4", "plotratio": 50 }'
run_particle '{ "method": "dnewton", "r": 12.0, "elevation": 90.0, "spin": 1.0, "Lfac": 1.0, "integrator": "sc6", "plotratio": 50 }'

run_light '{ "r": 3, "spin": 1.0, "integrator": "rk4", "plotratio": 500 }'
run_light '{ "r": 3, "spin": 1.0, "integrator": "rk438", "plotratio": 500 }'
run_light '{ "r": 3, "spin": 1.0, "integrator": "sc4" }'
run_light '{ "r": 3, "spin": 1.0, "integrator": "sc6" }'

run_light '{ "r": 2, "spin": 1.0, "integrator": "rk4", "plotratio": 200 }'
run_light '{ "r": 2, "spin": 1.0, "integrator": "rk438", "plotratio": 200 }'
run_light '{ "r": 2, "spin": 1.0, "integrator": "sc4" }'
run_light '{ "r": 2, "spin": 1.0, "integrator": "sc6" }'

echo ${C}"./nbody3d"${NC}
ssic='ic/SolarSystem'
jq . $ssic
$exe <$ssic 2>/tmp/progress | ./plotNBody.py

params='{ "IC": { "r0": 12.0, "Lfac": 0.8, "start": 0.0, "end": 5000.0, "step": 0.01, "integrator": "sc4", "plotratio": 200 } }'
echo ${C}"./newton"${NC}
echo $params | jq .
echo $params | $exe | ./plotBH.py 1.0 `echo $params | jq .IC.Lfac` 0.0

